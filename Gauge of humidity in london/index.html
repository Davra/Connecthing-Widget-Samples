<!-- Styles -->
<style>
#chartdiv {
	width	: 100%;
	height	: 100%;
	overflow : hidden;
}															
</style>

<!-- Resources -->
<script src="/ui/connecthing/vendors/amcharts/amcharts/amcharts.js"></script>  
<script src="/ui/connecthing/vendors/amcharts/amcharts/gauge.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script> 
<script src="/ui/connecthing/vendors/amcharts/amcharts/plugins/export/export.min.js"></script>
<link rel="stylesheet" href="/ui/connecthing/vendors/amcharts/amcharts/plugins/export/export.css" type="text/css" media="all" />
<script src="https://www.amcharts.com/lib/3/themes/none.js"></script>

<!-- Chart code -->
<script>
var gaugeChart = AmCharts.makeChart( "chartdiv", {
  "type": "gauge",
  "theme": "none",
  "axes": [ {
    "axisThickness": 1,
    "axisAlpha": 0.1,
    "tickAlpha": 0.1,
    "valueInterval": 20,
    "bands": [ {
      "color": "#84b761",
      "endValue": 90,
      "startValue": 0
    }, {
      "color": "#fdd400",
      "endValue": 130,
      "startValue": 90
    }, {
      "color": "#cc4748",
      "endValue": 220,
      "innerRadius": "95%",
      "startValue": 130
    } ],
    "bottomText": "0 km/h",
    "bottomTextYOffset": -20,
    "endValue": 220
  } ],
  "arrows": [ {} ],
  "export": {
    "enabled": true
  }
} );


$(function() {
            
    console.log('--- Custom Widget Template here. Starting');
    // This url will give the current weather conditions in London
    // You could visit it using your browser to see
    // var urlToGet = 'https://stationdata.wunderground.com/cgi-bin/stationlookup?station=ILONDON581&units=metric&v=2.0&format=json';
    var urlToGet = 'https://www.imonnit.com/json/SensorGet/c2F2aW8ubGVlOmluZ3JhbTEyMw==?sensorID=351529';
    // var urlToGeth = 'https://www.imonnit.com/json/SensorGet/c2F2aW8ubGVlOmluZ3JhbTEyMw==?sensorID=351529';
  
    $.ajax(urlToGet, {
        //contentType: "application/json",
        
        //dataType: "json",
        method: "GET",
        error: function(xhr, status, err){
            console.log('--- Custom Widget Template Experienced an error');
        },
        success: function(data, status, xhr){
           // var json = JSON.parse(data);
            var json = jQuery.parseJSON(JSON.stringify(data));
            console.log('--- Custom Widget Template got a response. ', data);
            console.log('--- Exploring the data.Result ', json); 
            // Get the first weather station returned
            var weatherStationKey = Object.keys(data)[1];
             console.log('--- Exploring the weatherSKEY', Object.keys(data)[1]);
            var stationObject = data[weatherStationKey];
            console.log('--- Exploring the result', data[weatherStationKey]);
            console.log('--- Exploring the stationObject.humidity ', stationObject.CurrentReading);

               
               //setInterval( randomValue, 2000 );         
              var value = Math.round( Math.random() * 200 );
              if ( gaugeChart ) {
                if ( gaugeChart.arrows ) {
                  if ( gaugeChart.arrows[ 0 ] ) {
                    if ( gaugeChart.arrows[ 0 ].setValue ) {
                      gaugeChart.arrows[ 0 ].setValue(parseInt(stationObject.CurrentReading));
                      gaugeChart.axes[ 0 ].setBottomText( stationObject.CurrentReading + "" );
                    }
                  }
                }
              }              

        }
    })
});


</script>

<!-- HTML -->
<div id="chartdiv"></div>	
